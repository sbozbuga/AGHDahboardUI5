<mvc:View
	controllerName="ui5.aghd.controller.Logs"
	displayBlock="true"
	xmlns="sap.m"
	xmlns:mvc="sap.ui.core.mvc"
	xmlns:core="sap.ui.core"
	core:require="{
		DateTime: 'sap/ui/model/type/DateTime'
	}">

	<App id="app">
		<Page
			title="{i18n>logsTitle}"
			id="page">
				<Table
					id="logsTable"
					items="{/data}"
					inset="false"
					growing="true"
					growingThreshold="50"
					growingScrollToLoad="true"
					sticky="ColumnHeaders,HeaderToolbar"
					alternateRowColors="true"
					noDataText="{i18n>noLogsFound}"
					updateFinished=".onUpdateFinished">
					<headerToolbar>
						<OverflowToolbar>
							<Button icon="sap-icon://nav-back" press=".onNavBack" tooltip="{i18n>back}" />
							<Title text="{i18n>logsHeader}" level="H2"/>
							<ToolbarSpacer/>
							<SearchField
								id="searchField"
								width="auto"
								search=".onSearch"
								liveChange=".onSearch"
								placeholder="{i18n>searchPlaceholder}"
								tooltip="{i18n>searchPlaceholder}"
								maxLength="200">
								<layoutData>
									<OverflowToolbarLayoutData
										minWidth="200px"
										maxWidth="300px"
										shrinkable="true"
										priority="NeverOverflow" />
								</layoutData>
							</SearchField>
							<Button icon="sap-icon://sort" press=".onOpenViewSettings" tooltip="{i18n>sortFilter}"/>
							<Button icon="sap-icon://refresh" press=".onRefreshLogs" tooltip="{i18n>refresh}"/>
                            <ToolbarSeparator />
                            <Button text="{i18n>smartAnalysis}" icon="sap-icon://lightbulb" press=".onAnalyzeLogs" type="Emphasized" tooltip="{i18n>generateAIInsights}" />
                            <Button icon="sap-icon://filter" press=".onOpenAdvancedFilter" tooltip="{i18n>advancedFilter}" type="{= ${/advancedFilters}.length > 0 ? 'Emphasized' : 'Default' }" />
                            <Button icon="sap-icon://action-settings" press=".onOpenSettings" tooltip="{i18n>settings}" />
						</OverflowToolbar>
					</headerToolbar>
					<columns>
						<Column width="11rem" id="colTime">
							<header>
								<Button text="{i18n>time}" press=".onSort" type="Transparent">
									<customData>
										<core:CustomData key="key" value="time" />
									</customData>
								</Button>
							</header>
						</Column>
						<Column width="4rem" hAlign="Center" id="colSource">
							<header>
								<Text text="{i18n>src}" />
							</header>
						</Column>
						<Column width="16rem" demandPopin="true" minScreenWidth="Tablet" id="colClient">
							<header>
								<Button text="{i18n>client}" press=".onSort" type="Transparent">
									<customData>
										<core:CustomData key="key" value="client" />
									</customData>
								</Button>
							</header>
						</Column>
						<Column id="colQuestion">
							<header>
								<Button text="{i18n>question}" press=".onSort" type="Transparent">
									<customData>
										<core:CustomData key="key" value="question/name" />
									</customData>
								</Button>
							</header>
						</Column>
						<Column width="6rem" demandPopin="true" minScreenWidth="Tablet" id="colStatus">
							<header>
								<Button text="{i18n>status}" press=".onSort" type="Transparent">
									<customData>
										<core:CustomData key="key" value="status" />
									</customData>
								</Button>
							</header>
						</Column>
						<Column width="5rem" demandPopin="true" minScreenWidth="Tablet" id="colBlocked" hAlign="Center">
							<header>
								<Text text="{i18n>blocked}" />
							</header>
						</Column>
						<Column width="6rem" demandPopin="true" minScreenWidth="Desktop" hAlign="End" id="colElapsed">
							<header>
								<Button text="{i18n>elapsedMs}" press=".onSort" type="Transparent">
									<customData>
										<core:CustomData key="key" value="elapsedMs" />
									</customData>
								</Button>
							</header>
						</Column>
						<Column width="22rem" demandPopin="true" minScreenWidth="Desktop" id="colUpstream">
							<header>
								<Button text="{i18n>upstream}" press=".onSort" type="Transparent">
									<customData>
										<core:CustomData key="key" value="upstream" />
									</customData>
								</Button>
							</header>
						</Column>
						<Column width="10rem" demandPopin="true" minScreenWidth="Desktop" id="colReason">
							<header>
								<Button text="{i18n>reason}" press=".onSort" type="Transparent">
									<customData>
										<core:CustomData key="key" value="reason" />
									</customData>
								</Button>
							</header>
						</Column>
						<Column width="6rem" demandPopin="true" minScreenWidth="Desktop" id="colFilterId">
							<header>
								<Button text="{i18n>filterId}" press=".onSort" type="Transparent">
									<customData>
										<core:CustomData key="key" value="filterId" />
									</customData>
								</Button>
							</header>
						</Column>
						<Column demandPopin="true" minScreenWidth="Desktop" id="colRule">
							<header>
								<Button text="{i18n>rule}" press=".onSort" type="Transparent">
									<customData>
										<core:CustomData key="key" value="rule" />
									</customData>
								</Button>
							</header>
						</Column>
					</columns>
					<items>
						<ColumnListItem vAlign="Middle">
							<cells>
								<Text text="{
									path: 'time',
									type: 'DateTime',
									formatOptions: {
										pattern: 'yyyy-MM-dd HH:mm:ss.SSS'
									}
								}" />
								<core:Icon src="sap-icon://database" 
									color="Positive" 
									visible="{= ${reason}.indexOf('served from cache') > -1 || ${reason} === 'Rewrite' }" 
									tooltip="{reason}"
									decorative="false"
									alt="{reason}" />
								<HBox alignItems="Center" wrap="Wrap">
									<Text text="{client}" class="sapUiTinyMarginEnd" />
									<Button icon="sap-icon://copy" type="Transparent" press=".onCopyClient" tooltip="{i18n>copyClient}" />
								</HBox>
								<HBox alignItems="Center" wrap="Wrap">
									<Text text="{question/name} ({question/type})" wrapping="true" maxLines="2" class="sapUiTinyMarginEnd" />
									<Button icon="sap-icon://copy" type="Transparent" press=".onCopyDomain" tooltip="{i18n>copyDomain}" />
								</HBox>
								<ObjectStatus
									text="{status}"
									state="{= ${status} === 'OK' ? 'Success' : 'Error'}" />
								<core:Icon src="sap-icon://decline" color="Negative" visible="{= ${blocked} === true }" tooltip="{i18n>requestBlocked}" alt="{i18n>requestBlocked}" decorative="false" />
								<ObjectNumber
									number="{
										path: 'elapsedMs',
										formatter: '.formatter.formatElapsed'
									}"
									state="{
										path: 'elapsedMs',
										formatter: '.formatter.formatElapsedState'
									}"
									tooltip="{
										path: 'elapsedMs',
										formatter: '.formatter.formatElapsedStateText'
									}" />
								<Text text="{upstream}" wrapping="true" maxLines="2" />
								<Text text="{reason}" wrapping="true" maxLines="2" />
								<Text text="{filterId}" />
								<Text text="{rule}" wrapping="true" maxLines="2" />
							</cells>
						</ColumnListItem>
					</items>
				</Table>
		</Page>
	</App>

</mvc:View>