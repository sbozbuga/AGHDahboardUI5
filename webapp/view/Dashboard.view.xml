<mvc:View
	controllerName="ui5.aghd.controller.Dashboard"
	xmlns="sap.m"
	xmlns:mvc="sap.ui.core.mvc"
	xmlns:f="sap.f"
	xmlns:card="sap.f.cards"
	displayBlock="true">

	<Page title="AdGuard Home Dashboard">
		<content>
			<GenericTile
				class="sapUiTinyMarginBegin sapUiTinyMarginTop"
				header="Total Queries"
				subheader="Last 24 hours"
				press="onPressLogs"
				tooltip="View query log">
				<TileContent>
					<NumericContent value="{/num_dns_queries}" icon="sap-icon://line-chart" />
				</TileContent>
			</GenericTile>

			<GenericTile
				class="sapUiTinyMarginBegin sapUiTinyMarginTop"
				header="Blocked Queries"
				subheader="Last 24 hours"
				press="onPressBlockedLogs"
				tooltip="View blocked query log">
				<TileContent>
					<NumericContent value="{/num_blocked_filtering}" icon="sap-icon://shield" valueColor="Error" />
				</TileContent>
			</GenericTile>

			<GenericTile
				class="sapUiTinyMarginBegin sapUiTinyMarginTop"
				header="Processing Time"
				subheader="Average"
				frameType="OneByOne"
				press="onPressLogs"
				tooltip="View query performance logs">
				<TileContent>
					<NumericContent value="{/avg_processing_time}" scale="ms" icon="sap-icon://performance" valueColor="Good" />
				</TileContent>
			</GenericTile>

			<GenericTile
				class="sapUiTinyMarginBegin sapUiTinyMarginTop"
				header="Blocked %"
				subheader="Efficiency"
				frameType="OneByOne"
				press="onPressBlockedLogs"
				tooltip="View blocked query logs">
				<TileContent>
					<NumericContent value="{/block_percentage}" scale="%" icon="sap-icon://pie-chart" valueColor="Critical" />
				</TileContent>
			</GenericTile>

            <f:GridContainer class="sapUiSmallMarginTop">
                <f:layout>
                    <f:GridContainerSettings rowSize="84px" columnSize="84px" gap="8px" />
                </f:layout>
                <f:layoutXS>
                    <f:GridContainerSettings rowSize="70px" columnSize="70px" gap="8px" />
                </f:layoutXS>
                
                <!-- Top Clients Card -->
                <f:Card>
                    <f:layoutData>
                        <f:GridContainerItemLayoutData columns="4" rows="6" />
                    </f:layoutData>
                    <f:header>
                        <card:Header title="Top Clients" iconSrc="sap-icon://group" />
                    </f:header>
                    <f:content>
                        <Table items="{/top_clients}" inset="false" fixedLayout="false" class="sapUiSizeCompact" alternateRowColors="true" noDataText="No active clients found">
                            <columns>
                                <Column><Text text="Client" /></Column>
                                <Column hAlign="End" width="30%"><Text text="Count" /></Column>
                            </columns>
                            <items>
                                <ColumnListItem type="Navigation" press=".onPressClient">
                                    <cells>
                                        <Text text="{name}" />
                                        <Text text="{count}" />
                                    </cells>
                                </ColumnListItem>
                            </items>
                        </Table>
                    </f:content>
                </f:Card>

                <!-- Top Domains Card -->
                <f:Card>
                    <f:layoutData>
                        <f:GridContainerItemLayoutData columns="4" rows="6" />
                    </f:layoutData>
                    <f:header>
                        <card:Header title="Top Queried Domains" iconSrc="sap-icon://world" />
                    </f:header>
                     <f:content>
                        <Table items="{/top_queried_domains}" inset="false" fixedLayout="false" class="sapUiSizeCompact" alternateRowColors="true" noDataText="No queries recorded yet">
                             <columns>
                                <Column><Text text="Domain" /></Column>
                                <Column hAlign="End" width="30%"><Text text="Count" /></Column>
                            </columns>
                            <items>
                                <ColumnListItem type="Navigation" press=".onPressDomain">
                                    <cells>
                                        <Text text="{name}" />
                                        <Text text="{count}" />
                                    </cells>
                                </ColumnListItem>
                            </items>
                        </Table>
                    </f:content>
                </f:Card>

                <!-- Top Blocked Domains Card -->
                <f:Card>
                    <f:layoutData>
                        <f:GridContainerItemLayoutData columns="4" rows="6" />
                    </f:layoutData>
                    <f:header>
                        <card:Header title="Top Blocked Domains" iconSrc="sap-icon://decline" />
                    </f:header>
                     <f:content>
                        <Table items="{/top_blocked_domains}" inset="false" fixedLayout="false" class="sapUiSizeCompact" alternateRowColors="true" noDataText="No blocked domains found">
                             <columns>
                                <Column><Text text="Domain" /></Column>
                                <Column hAlign="End" width="30%"><Text text="Count" /></Column>
                            </columns>
                            <items>
                                <ColumnListItem type="Navigation" press=".onPressBlockedDomain">
                                    <cells>
                                        <Text text="{name}" />
                                        <Text text="{count}" />
                                    </cells>
                                </ColumnListItem>
                            </items>
                        </Table>
                    </f:content>
                </f:Card>

                <!-- Slowest Queries Card -->
                <f:Card>
                    <f:layoutData>
                        <f:GridContainerItemLayoutData columns="4" rows="6" />
                    </f:layoutData>
                    <f:header>
                        <card:Header title="Slowest Queries (Last 1000)" iconSrc="sap-icon://time-account" />
                    </f:header>
                     <f:content>
                        <Table items="{/slowest_queries}" inset="false" fixedLayout="true" class="sapUiSizeCompact" alternateRowColors="true" noDataText="No query performance data available">
                             <columns>
                                <Column><Text text="Domain" /></Column>
                                <Column hAlign="End" width="30%"><Text text="Elapsed (ms)" /></Column>
                            </columns>
                            <items>
                                <ColumnListItem
                                    type="Navigation"
                                    press=".onPressSlowestDomain"
                                    tooltip="{
                                        path: 'occurrences',
                                        formatter: '.formatter.slowestTooltip'
                                    }">
                                    <cells>
                                        <Text
                                            text="{
                                                parts: [
                                                    {path: 'domain'},
                                                    {path: 'occurrences'}
                                                ],
                                                formatter: '.formatter.formatDomainWithCount'
                                            }" />
                                        <ObjectNumber
											number="{
												path: 'elapsedMs',
												formatter: '.formatter.formatElapsed'
											}"
											state="Warning" 
                                             />
                                    </cells>
                                </ColumnListItem>
                            </items>
                        </Table>
                    </f:content>
                </f:Card>
            </f:GridContainer>
		</content>
		<footer>
			<OverflowToolbar>
				<ToolbarSpacer />
				<Button text="View Logs" press="onPressLogs" type="Emphasized" />
                <Button icon="sap-icon://log" tooltip="Logout" press="onLogoutPress" />
			</OverflowToolbar>
		</footer>
	</Page>
</mvc:View>
